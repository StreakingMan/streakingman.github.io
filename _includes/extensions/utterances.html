<script async
        crossorigin="anonymous"
        issue-term="{{ site.utterances.issue_term }}"
        label="{{ site.utterances.label }}"
        repo="{{ site.utterances.repo }}"
        src="https://utteranc.es/client.js"
        onload="test()"
        theme="{{ site.utterances.theme }}">
</script>

<script>
  const test = () => {
    console.log(document.querySelector('.utterances-frame'))
    setTimeout(() => {
      console.log(document.querySelector('.utterances-frame'))
    })
    setTimeout(() => {
      console.log(1000,document.querySelector('.utterances-frame'))
    },1000)
    setTimeout(() => {
      console.log(2000,document.querySelector('.utterances-frame'))
    },2000)
    setTimeout(() => {
      console.log(3000,document.querySelector('.utterances-frame'))
    },3000)
  }

  const setUtterancesTheme = (dataTheme) => {
    const iframe = document.querySelector('.utterances-frame');
    if (iframe) {
      const utterancesTheme = dataTheme === 'dark' ? 'github-dark' : 'github-light'
      const message = {
        type: 'set-theme',
        theme: utterancesTheme
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es');
    }
  }

  // 动态监听
  const observer = new MutationObserver((mutationsList, observer) => {
    for (let mutation of mutationsList) {
      if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
        setUtterancesTheme(document.documentElement.getAttribute('data-theme'))
      }
    }
  });
  observer.observe(document.documentElement, {attributes: true, childList: false, subtree: false});

  console.log(document.documentElement.getAttribute('data-theme'))

  // 初始化
  setTimeout(() => {
    setUtterancesTheme(document.documentElement.getAttribute('data-theme'))
  }, 5000)
</script>
