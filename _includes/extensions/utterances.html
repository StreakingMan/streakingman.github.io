<script async
        crossorigin="anonymous"
        issue-term="{{ site.utterances.issue_term }}"
        label="{{ site.utterances.label }}"
        repo="{{ site.utterances.repo }}"
        src="https://utteranc.es/client.js"
        theme="{{ site.utterances.theme }}">
</script>

<script>
  const setUtterancesTheme = (dataTheme)=>{
    const iframe = document.querySelector('iframe.utterances-frame');
    if (iframe) {
      const utterancesTheme = dataTheme === 'dark' ? 'github-dark' : 'github-light'
      const message = {
        type: 'set-theme',
        theme: utterancesTheme
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es');
    }
  }
  // 初始化
  setUtterancesTheme(document.documentElement.getAttribute('data-theme'))

  // 动态监听
  const observer = new MutationObserver((mutationsList, observer) => {
    for (let mutation of mutationsList) {
      if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
        setUtterancesTheme(document.documentElement.getAttribute('data-theme'))
      }
    }
  });
  observer.observe(document.documentElement, {attributes: true, childList: false, subtree: false});
</script>
